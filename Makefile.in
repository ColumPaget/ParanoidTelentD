
CC = @CC@
VERSION = @VERSION@
CFLAGS = @CFLAGS@
LIBS = @LIBS@
INSTALL=@INSTALL@
prefix=@prefix@
sbindir=@sbindir@
mandir=@mandir@
FLAGS=$(CFLAGS) @DEFS@
OBJ=Authenticate.o common.o telnet-protocol.o settings.o 
EXE=ptelnetd

all: $(OBJ) main.c
	@cd libUseful-3; $(MAKE)
	gcc -g -o$(EXE) $(OBJ) main.c libUseful-3/libUseful-3.a $(LIBS)


Authenticate.o: Authenticate.c Authenticate.h
	gcc $(FLAGS) -c Authenticate.c

settings.o: settings.c settings.h
	gcc $(FLAGS) -c settings.c

telnet-protocol.o: telnet-protocol.c telnet-protocol.h
	gcc $(FLAGS) -c telnet-protocol.c

common.o: common.c common.h
	gcc $(FLAGS) -c common.c

clean:
	-rm -f *.o */*.o */*.a */*.so $(EXE)
	-rm -f config.log config.status */config.log */config.status
	-rm -fr autom4te.cache */autom4te.cache

distclean:
	-rm -f *.o */*.o */*.a */*.so $(EXE)
	-rm -f config.log config.status */config.log */config.status Makefile */Makefile
	-rm -fr autom4te.cache */autom4te.cache

install:
	@mkdir -p $(DESTDIR)/$(prefix)/sbin
	@mkdir -p $(DESTDIR)/$(mandir)/man1
	cp -f ptelnetd $(DESTDIR)/$(prefix)/sbin
	cp -f ptelnetd.1 $(DESTDIR)/$(mandir)/man1

